

<title>数据表格的重载 - 数据表格</title>
<OBJECT id="WebOcx" name="WebOcx" classid="clsid:1ED44FB1-A30D-4172-80C6-A3558144B642" width="0" height="0" VIEWASTEXT codebase="V3ClientOcxsetup20130729.exe#version=1,1,0,3">
</OBJECT>
<link rel="stylesheet" href="../../../../jhzhps-front-3/src/style/ext-all.css" /></link>
<link rel="stylesheet" href="../../../../jhzhps-front-3/src/style/global.css" /></link>
<link rel="stylesheet" href="../../../../jhzhps-front-3/src/style/SpryTabbedPanels.css" /></link>
<link rel="stylesheet" href="../../../../jhzhps-front-3/src/style/videoMon.css" /></link>
<script type="text/javascript" src="../../../../jhzhps-front-3/src/controller/ext-base.js"></script>
<script type="text/javascript" src="../../../../jhzhps-front-3/src/controller/ext-all.js"></script>
<script type="text/javascript" src="../../../../jhzhps-front-3/src/controller/SpryTabbedPanels.js" ></script>
<script language="javascript" charset="utf-8" type="text/javascript" src="../../../../jhzhps-front-3/src/controller/recordSearch1.js"></script>
<div class="layui-card layadmin-header">
	<div class="layui-breadcrumb" lay-filter="breadcrumb">
		<a lay-href="">主页</a>
		<a><cite>监测预警</cite></a>
		<a><cite>视频监控</cite></a>
	</div>
</div>
<div class="layui-fluid" id='cons'>
	<div class="layui-row" >
		<div class="layui-col-md12 layui-card">
			<div class="layui-col-md12">
				<div id="header">
				   <div class="text1">
				    首次使用请先安装插件
				    <a href="./WebOcx.exe">下载</a>
				   </div>
				</div> 
				 <div id="contain"> 
				   <div id="mainbg"> 
				    <div class="TabbedPanels" id="TabbedPanels1"> 
				     <ul class="TabbedPanelsTabGroup"> 
				      <li class="TabbedPanelsTab" tabindex="0">视频监控</li> 
				      <li class="TabbedPanelsTab" tabindex="0">录像下载</li> 
				      <li style="width:500px; float:right; display: block;"> 
				       <form name="form1"> 
				        <table style="width:500px; " border="0" cellspacing="0" cellpadding="0"> 
				         <tbody>
				          <tr> 
				           <td width="45" align="right">登录IP:</td> 
				           <td width="81"><input type="text" name="loginIp" value="183.131.146.124" style="width:80px; border:1px solid #7F9DB9" /></td> 
				           <td width="36" align="right">端口:</td> 
				           <td width="51"><input name="loginPort" type="text" value="6666" style="width:50px; border:1px solid #7F9DB9" /></td> 
				           <td width="45" align="right">用户名:</td> 
				           <td width="81"><input type="text" name="userName" value="zhd@jhsjsj.jhhy.zj.ge" style="width:80px; border:1px solid #7F9DB9" /></td> 
				           <td width="36" align="right">密码:</td> 
				           <td width="51"><input name="userPassword" type="password" value="123456" style="width:50px; border:1px solid #7F9DB9" /></td> 
				           <td width="63"><img src="../../../../jhzhps-front-3/src/style/res/login.gif" name="login1" onclick="Login();" /></td> 
				          </tr> 
				         </tbody>
				        </table>
				       </form> </li> 
				     </ul> 
				     <div class="TabbedPanelsContentGroup"> 
				      <div class="TabbedPanelsContent">
				       <div id="links"> 
				        <div class="text">
				         <div id="righttop0"> 
				          <div id="control_header">
				           &nbsp;&nbsp;&nbsp;&nbsp;视频控制
				          </div>
				          <form name="form2">
				           <div id="control2">
				            <table width="184" height="115" border="0" cellpadding="0" cellspacing="0"> 
				             <tbody>
				              <tr>
				               <td> </td>
				              </tr> 
				              <tr> 
				               <td width="39" height="35">&nbsp;</td> 
				               <td width="49" align="center"><img src="../../../../jhzhps-front-3/src/style/res/y_up.gif" alt="上" name="Image1" width="27" height="32" border="0" id="Image1" onmousedown="TurnUp();" onmouseup="StopTurn();" /></td> 
				               <td width="42" align="left"><img src="../../../../jhzhps-front-3/src/style/res/big.gif" alt="拉近" width="32" height="22" border="0" id="Image6" onmousedown="LenNear();" onmouseup="StopTurn();" /></td> 
				               <td width="54" align="center"><img src="../../../../jhzhps-front-3/src/style/res/auto2.gif" width="35" height="19" border="0" alt="自动对焦" onclick="" /></td> 
				              </tr> 
				              <tr> 
				               <td height="40" align="right"><img src="../../../../jhzhps-front-3/src/style/res/y_left.gif" alt="左" name="Image3" width="32" height="27" border="0" id="Image3" onmousedown="TurnLeft();" onmouseup="StopTurn();" /></td> 
				               <td width="49" align="center"><img src="../../../../jhzhps-front-3/src/style/res/y_middle2.gif" alt="断开视频" name="Image5" width="27" height="27" border="0" id="Image5" onclick="Stop();" /></td> 
				               <td align="left"><img src="../../../../jhzhps-front-3/src/style/res/y_right.gif" alt="右" name="Image2" width="32" height="27" border="0" id="Image2" onmousedown="TurnRight();" onmouseup="StopTurn();" /></td> 
				               <td width="54" align="center"><img src="../../../../jhzhps-front-3/src/style/res/focusout2.gif" width="35" height="19" border="0" alt="视频调亮" onclick="Brighten();" /></td> 
				              </tr> 
				              <tr> 
				               <td height="36">&nbsp;</td> 
				               <td width="49" align="center"><img src="../../../../jhzhps-front-3/src/style/res/y_down.gif" alt="下" name="Image4" width="27" height="32" border="0" id="Image4" onmousedown="TurnDown();" onmouseup="StopTurn();" /></td> 
				               <td align="left"><img src="../../../../jhzhps-front-3/src/style/res/small.gif" alt="拉远" width="32" height="22" border="0" id="Image7" onmousedown="LenFar();" onmouseup="StopTurn();" /></td> 
				               <td width="54" align="center"><img src="../../../../jhzhps-front-3/src/style/res/focus2.gif" width="35" height="19" border="0" alt="视频调暗" onclick="Darken();" /></td> 
				              </tr> 
				             </tbody>
				            </table> 
				           </div>
				          </form>
				          <div id="control2"> 
				           <table width="175" height="30" border="0" cellpadding="0" cellspacing="0"> 
				            <tbody>
				             <tr> 
				              <td width="47"><img src="../../../../jhzhps-front-3/src/style/res/one_screen.gif" width="35" height="19" border="0" alt="单屏" name="num" onclick="changeScreen(1);" /></td> 
				              <td width="49"><img src="../../../../jhzhps-front-3/src/style/res/four_screen.gif" width="35" height="19" border="0" alt="四屏" onclick="changeScreen(4);" /></td> 
				              <td width="47"><img src="../../../../jhzhps-front-3/src/style/res/six_screen.gif" width="35" height="19" border="0" alt="六屏" onclick="changeScreen(6);" /></td> 
				              <td width="35"><img src="../../../../jhzhps-front-3/src/style/res/nine_screen.gif" width="35" height="19" border="0" alt="九屏" onclick="changeScreen(9);" /></td> 
				             </tr> 
				            </tbody>
				           </table> 
				          </div>
				         </div> 
				         <div id="righttop1" style="display:none">
				          <div id="search_header">
				           &nbsp;&nbsp;&nbsp;&nbsp;录像检索条件:
				          </div> 
				          <div class="x-form-bd" id="control2"> 
				           <table width="98%" border="0" cellpadding="0" cellspacing="0" style="margin-top:5px"> 
				            <tbody>
				             <tr class="x-form-item"> 
				              <td width="33%" height="30">摄&nbsp;像&nbsp;头：</td> 
				              <td align="left" width="67%"><input id="fdNameSelect" type="text" style="width: 120px" disabled="" /><br /><font color="blue">(从列表中选相应设备)</font> </td> 
				             </tr> 
				             <tr class="x-form-item"> 
				              <td height="28">录像种类：</td> 
				              <td align="left"><select class="x-combo-list" name="recordType" id="recordType" style="width: 120px"> <option value="0">前端录像</option> <option value="1">中心录像</option> </select></td> 
				             </tr>
				             <tr class="x-form-item"> 
				              <td height="28">开始时间：</td> 
				              <td align="left"><input type="text" class="Wdate" id="BeginTime_1" style="width:120px" title="开始时间" onfocus="calendar();" /></td> 
				             </tr>
				             <tr class="x-form-item"> 
				              <td height="28">结束时间：</td> 
				              <td align="left"><input type="text" class="Wdate" id="EndTime_1" style="width:120px" title="截至时间" onfocus="calendar();" /></td> 
				             </tr>
				             <tr class="x-form-item"> 
				              <td height="28"><input type="button" class="bbut" onclick="QueryRecord();" value="&nbsp;查询&nbsp;" /></td> 
				              <td height="28"> <input type="button" class="bbut" onclick="PlayRecord()" value="&nbsp;回放&nbsp;" /></td> 
				              <td height="28"> <input type="button" class="bbut" onclick="DownloadRecord()" value="&nbsp;下载&nbsp;" /></td> 
				             </tr> 
				            </tbody>
				           </table> 
				          </div>
				         </div> 
				         <div id="rightbottom"> 
				          <div id="list_header"></div> 
				          <div id="tree-div"></div> 
				         </div> 
				        </div> 
				       </div>
				       <div id="main0"> 
				        <div class="text3">
				         <object id="VOcx" name="VOcx" classid="clsid:41574951-5BCE-4577-AAAB-70A8E3C2E891" width="0px" height="0px"> </object>
				        </div> 
				       </div> 
				       <div id="main1"> 
				        <div class="text"> 
				        </div> 
				       </div> 
				       <div id="main2" style="display:none"> 
				        <div class="x-form-bd" id="container"> 
				         <div class="x-form-bd" id="south_div"> 
				          <div id="videoSearch_Div"> 
				           <div id="searchgrid" style="border: 0px solid #b5b8c8; height: 130px;"></div> 
				          </div> 
				         </div> 
				        </div> 
				       </div> 
				      </div> 
				      <div class="TabbedPanelsContent" style="display:none"></div> 
				     </div> 
				    </div> 
				    <script type="text/javascript">
						var TabbedPanels1 = new Spry.Widget.TabbedPanels("TabbedPanels1");
					</script> 
				   </div> 
				  </div> 
				  <div id="footer"></div> 
				  <div> 
				  </div> 
			</div>
		</div>
	</div>
</div>
<div class="copyright">
		版权所有@2018 金华市政管理处
</div>
<script type="text/javascript">
	window.onload = function(){
		init();
	}
	window.onunload =function(){
		Quit();
	}
</script>
<script type="text/javascript">
	// JavaScript Document
//JS DateTimeCalendar 
document.write("<div align='center' id=meizzCalendarLayer style='BORDER-RIGHT: #000000 1px solid; PADDING-RIGHT: 5px; BORDER-TOP: #000000 1px solid; PADDING-LEFT: 5px; Z-INDEX: 999999; BACKGROUND: #ffffff; FILTER: Alpha(opacity=85); LEFT: 205px; PADDING-BOTTOM: 5px; BORDER-LEFT: #000000 1px solid; WIDTH: 215px; LINE-HEIGHT: 5px; PADDING-TOP: 5px; BORDER-BOTTOM: #000000 1px solid; POSITION: absolute; TOP: 220px; HEIGHT: 215px; display: none'>");
document.write("<iframe name=meizzCalendarIframe scrolling=no frameborder=0 width=100% height=100%></iframe></div>");
function writeIframe()
{
    var strIframe = "<html><head><meta http-equiv='Content-Type' content='text/html; charset=gb2312'><style>"+
    "*{font-size: 12px; font-family: 宋体}"+

    "</style></head><body onselectstart='return false' style='margin: 0px' oncontextmenu='return false'><form name=meizz>";
    if (WebCalendar.drag){ strIframe += "<scr"+"ipt language=javascript>"+
    "var drag=false, cx=0, cy=0, o = parent.WebCalendar.calendar; function document.onmousemove(){"+
    "if(parent.WebCalendar.drag && drag){if(o.style.left=='')o.style.left=0; if(o.style.top=='')o.style.top=0;"+
    "o.style.left = parseInt(o.style.left) + window.event.clientX-cx;"+
    "o.style.top  = parseInt(o.style.top)  + window.event.clientY-cy;}}"+
    "function document.onkeydown(){ switch(window.event.keyCode){  case 27 : parent.hiddenCalendar(); break;"+
    "case 37 : parent.prevM(); break; case 38 : parent.prevY(); break; case 39 : parent.nextM(); break; case 40 : parent.nextY(); break;"+
    "case 84 : document.forms[0].today.click(); break;} window.event.keyCode = 0; window.event.returnValue= false;}"+
    "function dragStart(){cx=window.event.clientX; cy=window.event.clientY; drag=true;}</scr"+"ipt>"}
    strIframe += "<select name=tmpYearSelect  onblur='parent.hiddenSelect(this)' style='z-index:1;position:absolute;top:3;left:40;display:none'"+
    " onchange='parent.WebCalendar.thisYear =this.value; parent.hiddenSelect(this); parent.writeCalendar();'></select>"+
    "<select name=tmpMonthSelect onblur='parent.hiddenSelect(this)' style='z-index:1; position:absolute;top:3;left:110;display:none'"+
    " onchange='parent.WebCalendar.thisMonth=this.value; parent.hiddenSelect(this); parent.writeCalendar();'></select>"+
    "<select name=tmpHourSelect onblur='parent.hiddenSelect(this)' style='z-index:1; position:absolute;top:179;left:35;display:none'"+
    " onchange='parent.WebCalendar.thisHour=this.value; parent.hiddenSelect(this); parent.writeCalendar();'></select>"+
    "<select name=tmpMinuteSelect onblur='parent.hiddenSelect(this)' style='z-index:1; position:absolute;top:179;left:80;display:none'"+
    " onchange='parent.WebCalendar.thisMinute=this.value; parent.hiddenSelect(this); parent.writeCalendar();'></select>"+
    "<select name=tmpSecondSelect onblur='parent.hiddenSelect(this)' style='z-index:1; position:absolute;top:179;left:125;display:none'"+
    " onchange='parent.WebCalendar.thisSecond=this.value; parent.hiddenSelect(this); parent.writeCalendar();'></select>"+
    "<table id=tableMain border='1' cellpadding='0' cellspacing='0' bordercolor='#C0D0E8' bordercolorlight='#C0D0E8' bordercolordark='#C0D0E8' width='100%' height='100%'>"+
    "<tr><td height=19 bgcolor='"+ WebCalendar.lightColor +"'>"+
    "    <table width='98%' id=tableHead border=0 cellspacing=1 cellpadding=0 align='center'><tr align=center>"+
    "    <td title='向前翻 1 年' onclick='parent.prevY()' style='cursor: hand' class=bg><<</td>"+
    "    <td width=15 height=19 class=bg title='向前翻 1 月' style='cursor: hand' onclick='parent.prevM()'><</td>"+
    "    <td width=60 id=meizzYearHead  title='点击此处选择年份' onclick='parent.funYearSelect(parseInt(this.innerText, 10))'"+
    "        onmouseover='this.bgColor=parent.WebCalendar.darkColor; this.style.color=parent.WebCalendar.lightColor'"+
    "        onmouseout='this.bgColor=parent.WebCalendar.lightColor; this.style.color=parent.WebCalendar.wordColor'></td>"+
    "    <td width=50 id=meizzYearMonth title='点击此处选择月份' onclick='parent.funMonthSelect(parseInt(this.innerText, 10))'"+
    "        onmouseover='this.bgColor=parent.WebCalendar.darkColor; this.style.color=parent.WebCalendar.lightColor'"+
    "        onmouseout='this.bgColor=parent.WebCalendar.lightColor; this.style.color=parent.WebCalendar.wordColor'></td>"+
    "    <td width=15 class=bg title='向后翻 1 月' onclick='parent.nextM()' style='cursor: hand'>></td>"+
    "    <td title='向后翻 1 年' onclick='parent.nextY()' style='cursor: hand' class=bg>>></td>"+
    "</tr></table>"+
    "</td></tr><tr><td height=20 align='center'><table id=tableWeek border=1 width='98%' cellpadding=0 cellspacing=0 ";
    if(WebCalendar.drag){strIframe += "onmousedown='dragStart()' onmouseup='drag=false' onmouseout='drag=false'";}
    strIframe += " borderColorLight='#FFFFFF' borderColorDark='#FFFFFF'>"+
    "    <tr align=center bgcolor='#6699FF'><td height=20><font color='#FF0000'>日</font></td><td>一</td><td>二</td><td>三</td><td>四</td><td>五</td><td><font color='#FF0000'>六</font></td></tr></table>"+
    "</td></tr><tr><td valign=top align='center' bgcolor='"+ WebCalendar.lightColor +"'>"+
    "    <table id=tableDay height='100%' width='98%' border=0 cellspacing=1 cellpadding=0>";
         for(var x=0; x<5; x++){ strIframe += "<tr>";
         for(var y=0; y<7; y++)  strIframe += "<td class=out id='meizzDay"+ (x*7+y) +"'></td>"; strIframe += "</tr>";}
         strIframe += "<tr>";
         for(var x=35; x<39; x++) strIframe += "<td class=out id='meizzDay"+ x +"'></td>";
         strIframe +="<td colspan=3 class=out title='"+ WebCalendar.regInfo +"'><input style=' background-color: "+
         WebCalendar.btnBgColor +";cursor: hand; padding-top: 4px; width: 100%; height: 100%; border: 0' onfocus='this.blur()'"+
         " type=button value='    关闭' onclick='parent.hiddenCalendar()'></td></tr></table>"+
    "</td></tr><tr><td height=20  align='center' bgcolor='"+ WebCalendar.lightColor +"'>"+
    "    <table border=0 cellpadding=1 cellspacing=0 width='98%'>"+
    "    <tr>"+
    "        <td width=15 height=19 title='向前翻 1 小时' onclick='parent.prevH()' style='cursor: hand' class=bg><<</td>"+
    "        <td width=15 height=19 title='向前翻 1 分钟' onclick='parent.prevMi()' style='cursor: hand' class=bg><</td>"+
    "        <td width=60 id=meizzHourHead  title='点击此处选择小时' onclick='parent.funHourSelect(parseInt(this.innerText, 10))'"+
    "        onmouseover='this.bgColor=parent.WebCalendar.darkColor; this.style.color=parent.WebCalendar.lightColor'"+
    "        onmouseout='this.bgColor=parent.WebCalendar.lightColor; this.style.color=parent.WebCalendar.wordColor'></td>"+
    "    <td width=50 id=meizzMinuteHead title='点击此处选择分钟' onclick='parent.funMinuteSelect(parseInt(this.innerText, 10))'"+
    "        onmouseover='this.bgColor=parent.WebCalendar.darkColor; this.style.color=parent.WebCalendar.lightColor'"+
    "        onmouseout='this.bgColor=parent.WebCalendar.lightColor; this.style.color=parent.WebCalendar.wordColor'></td>"+
    "    <td width=50 id=meizzSecondHead title='点击此处选择秒' onclick='parent.funSecondSelect(parseInt(this.innerText, 10))'"+
    "        onmouseover='this.bgColor=parent.WebCalendar.darkColor; this.style.color=parent.WebCalendar.lightColor'"+
    "        onmouseout='this.bgColor=parent.WebCalendar.lightColor; this.style.color=parent.WebCalendar.wordColor'></td>"+
    "        <td title='向后翻 1 分钟' onclick='parent.nextMi()' style='cursor: hand' class=bg>></td>"+
    "        <td title='向后翻 1 小时' onclick='parent.nextH()' style='cursor: hand' class=bg>>></td>"+
    "</tr></table>"+
    "</td></tr><table></form></body></html>";
    with(WebCalendar.iframe)
    {
        document.writeln(strIframe); document.close();
        for(var i=0; i<39; i++)
        {
            WebCalendar.dayObj[i] = eval("meizzDay"+ i);
            WebCalendar.dayObj[i].onmouseover = dayMouseOver;
            WebCalendar.dayObj[i].onmouseout  = dayMouseOut;
            WebCalendar.dayObj[i].onclick     = returnDate;
        }
    }
}
function WebCalendar() //初始化日历的设置
{
    this.daysMonth  = new Array(31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31);
    this.day        = new Array(39);            //定义日历展示用的数组
    this.dayObj     = new Array(39);            //定义日期展示控件数组
    this.dateStyle  = null;                     //保存格式化后日期数组
    this.objExport  = null;                     //日历回传的显示控件
    this.eventSrc   = null;                     //日历显示的触发控件
    this.inputDate  = null;                     //转化外的输入的日期(d/m/yyyy)
    this.thisYear   = new Date().getFullYear(); //定义年的变量的初始值
    this.thisMonth  = new Date().getMonth()+ 1; //定义月的变量的初始值
    this.thisDay    = new Date().getDate();     //定义日的变量的初始值
    this.thisHour   = new Date().getHours();    //定义小时得变量初始值
    this.thisMinute = new Date().getMinutes();  //定义分钟得变量初始值
    this.thisSecond = new Date().getSeconds();  //定义秒得标量的初始值
    this.today      = this.thisDay +"/"+ this.thisMonth +"/"+ this.thisYear;   //今天(d/m/yyyy)
    this.iframe     = window.frames("meizzCalendarIframe"); //日历的 iframe 载体
    this.calendar   = getObjectById("meizzCalendarLayer");  //日历的层
    this.dateReg    = "";           //日历格式验证的正则式
    this.yearFall   = 50;           //定义年下拉框的年差值
    this.format     = "yyyy-mm-dd"; //回传日期的格式
    this.timeShow   = true;        //是否返回时间
    this.drag       = false;         //是否允许拖动
    this.darkColor  = "#0000D0";    //控件的暗色
    this.lightColor = "#FFFFFF";    //控件的亮色
    this.btnBgColor = "#E6E6FA";    //控件的按钮背景色
    this.wordColor  = "#000080";    //控件的文字颜色
    this.wordDark   = "#DCDCDC";    //控件的暗文字颜色
    this.dayBgColor = "#F5F5FA";    //日期数字背景色
    this.todayColor = "#FF0000";    //今天在日历上的标示背景色
    this.DarkBorder = "#D4D0C8";    //日期显示的立体表达色
}   var WebCalendar = new WebCalendar();
function calendar() //主调函数
{
    var e = window.event.srcElement;   writeIframe();
    var o = WebCalendar.calendar.style; WebCalendar.eventSrc = e;
 if (arguments.length == 0) WebCalendar.objExport = e;
    else WebCalendar.objExport = eval(arguments[0]);
    WebCalendar.iframe.tableWeek.style.cursor = WebCalendar.drag ? "move" : "default";
 var t = e.offsetTop,  h = e.clientHeight, l = e.offsetLeft, p = e.type;
 while (e = e.offsetParent){t += e.offsetTop; l += e.offsetLeft;}
    o.display = ""; WebCalendar.iframe.document.body.focus();
    var cw = WebCalendar.calendar.clientWidth, ch = WebCalendar.calendar.clientHeight;
    var dw = document.body.clientWidth, dl = document.body.scrollLeft, dt = document.body.scrollTop;
    
    if (document.body.clientHeight + dt - t - h >= ch) o.top = (p=="image")? t + h : t + h + 6;
    else o.top  = (t - dt < ch) ? ((p=="image")? t + h : t + h + 6) : t - ch;
    if (dw + dl - l >= cw) o.left = l; else o.left = (dw >= cw) ? dw - cw + dl : dl;
    if  (!WebCalendar.timeShow) WebCalendar.dateReg = /^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/;
    else WebCalendar.dateReg = /^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/;
    try{
        if (WebCalendar.objExport.value.trim() != ""){
            WebCalendar.dateStyle = WebCalendar.objExport.value.trim().match(WebCalendar.dateReg);
            if (WebCalendar.dateStyle == null)
            {
                WebCalendar.thisYear   = new Date().getFullYear();
                WebCalendar.thisMonth  = new Date().getMonth()+ 1;
                WebCalendar.thisDay    = new Date().getDate();
                //alert("原文本框里的日期有错误！\n可能与你定义的显示时分秒有冲突！");
                writeCalendar(); return false;
            }
            else
            {
                WebCalendar.thisYear   = parseInt(WebCalendar.dateStyle[1], 10);
                WebCalendar.thisMonth  = parseInt(WebCalendar.dateStyle[3], 10);
                WebCalendar.thisDay    = parseInt(WebCalendar.dateStyle[4], 10);
                WebCalendar.inputDate  = parseInt(WebCalendar.thisDay, 10) +"/"+ parseInt(WebCalendar.thisMonth, 10) +"/"+ 
                parseInt(WebCalendar.thisYear, 10); writeCalendar();
            }
        }  else writeCalendar();
    }  catch(e){writeCalendar();}
}
function funMonthSelect() //月份的下拉框
{
    var m = isNaN(parseInt(WebCalendar.thisMonth, 10)) ? new Date().getMonth() + 1 : parseInt(WebCalendar.thisMonth);
    var e = WebCalendar.iframe.document.forms[0].tmpMonthSelect;
    for (var i=1; i<13; i++) e.options.add(new Option(i +"月", i));
    e.style.display = ""; e.value = m; e.focus(); window.status = e.style.top;
}
function funYearSelect() //年份的下拉框
{
    var n = WebCalendar.yearFall;
    var e = WebCalendar.iframe.document.forms[0].tmpYearSelect;
    var y = isNaN(parseInt(WebCalendar.thisYear, 10)) ? new Date().getFullYear() : parseInt(WebCalendar.thisYear);
        y = (y <= 1000)? 1000 : ((y >= 9999)? 9999 : y);
    var min = (y - n >= 1000) ? y - n : 1000;
    var max = (y + n <= 9999) ? y + n : 9999;
        min = (max == 9999) ? max-n*2 : min;
        max = (min == 1000) ? min+n*2 : max;
    for (var i=min; i<=max; i++) e.options.add(new Option(i +"年", i));
    e.style.display = ""; e.value = y; e.focus();
}

function funHourSelect() //小时的下拉框
{
    var e = WebCalendar.iframe.document.forms[0].tmpHourSelect;
    var h = isNaN(parseInt(WebCalendar.thisHour, 10)) ? new Date().getHours() : parseInt(WebCalendar.thisHour);
    for (var i=0; i<=23; i++) e.options.add(new Option(appendZero(i) +"时", i));
    e.style.display = ""; e.value = h; e.focus();
}

function funMinuteSelect() //分钟的下拉框
{
    var e = WebCalendar.iframe.document.forms[0].tmpMinuteSelect;
    var mi = isNaN(parseInt(WebCalendar.thisMinute, 10)) ? new Date().getMinutes() : parseInt(WebCalendar.thisMinute);
    for (var i=0; i<=59; i++) e.options.add(new Option(appendZero(i) +"分", i));
    e.style.display = ""; e.value = mi; e.focus();
}

function funSecondSelect() //秒的下拉框
{
    var e = WebCalendar.iframe.document.forms[0].tmpSecondSelect;
    var s = isNaN(parseInt(WebCalendar.thisSecond, 10)) ? new Date().getSecondes() : parseInt(WebCalendar.thisSecond);
    for (var i=0; i<=59; i++) e.options.add(new Option(appendZero(i) +"秒", i));
    e.style.display = ""; e.value = s; e.focus();
}

function prevM()  //往前翻月份
{
    WebCalendar.thisDay = 1;
    if (WebCalendar.thisMonth==1)
    {
        WebCalendar.thisYear--;
        WebCalendar.thisMonth=13;
    }
    WebCalendar.thisMonth--; writeCalendar();
}
function nextM()  //往后翻月份
{
    WebCalendar.thisDay = 1;
    if (WebCalendar.thisMonth==12)
    {
        WebCalendar.thisYear++;
        WebCalendar.thisMonth=0;
    }
    WebCalendar.thisMonth++; writeCalendar();
}

function prevH()   //往前翻小时
{
    WebCalendar.thisHour--;
    if(WebCalendar.thisHour==-1)
    {
         WebCalendar.thisHour=23;
    }
    writeCalendar();
}
function nextH()   //往后翻小时
{ 
    WebCalendar.thisHour++;
    if(WebCalendar.thisHour==24)
    {
         WebCalendar.thisHour=0;
    }
    writeCalendar();
}


function prevMi()   //往前翻小时
{
    WebCalendar.thisMinute--;
    if(WebCalendar.thisMinute==-1)
    {
         WebCalendar.thisMinute=59;
    }
    writeCalendar();
}
function nextMi()   //往后翻小时
{ 
    WebCalendar.thisMinute++;
    if(WebCalendar.thisMinute==60)
    {
         WebCalendar.thisMinute=0;
    }
    writeCalendar();
}


function prevY(){WebCalendar.thisDay = 1; WebCalendar.thisYear--; writeCalendar();}//往前翻 Year
function nextY(){WebCalendar.thisDay = 1; WebCalendar.thisYear++; writeCalendar();}//往后翻 Year
function hiddenSelect(e){for(var i=e.options.length; i>-1; i--)e.options.remove(i); e.style.display="none";}
function getObjectById(id){ if(document.all) return(eval("document.all."+ id)); return(eval(id)); }
function hiddenCalendar(){getObjectById("meizzCalendarLayer").style.display = "none";};
function appendZero(n){return(("00"+ n).substr(("00"+ n).length-2));}//日期自动补零程序
function String.prototype.trim(){return this.replace(/(^\s*)|(\s*$)/g,"");}
function dayMouseOver()
{
    this.className = "over";
    this.style.backgroundColor = WebCalendar.darkColor;
    if(WebCalendar.day[this.id.substr(8)].split("/")[1] == WebCalendar.thisMonth)
    this.style.color = WebCalendar.lightColor;
}
function dayMouseOut()
{
    this.className = "out"; var d = WebCalendar.day[this.id.substr(8)], a = d.split("/");
    this.style.removeAttribute('backgroundColor');
    if(a[1] == WebCalendar.thisMonth && d != WebCalendar.today)
    {
        if(WebCalendar.dateStyle && a[0] == parseInt(WebCalendar.dateStyle[4], 10))
        this.style.color = WebCalendar.lightColor;
        this.style.color = WebCalendar.wordColor;
    }
}
function writeCalendar() //对日历显示的数据的处理程序
{
    var y = WebCalendar.thisYear;
    var m = WebCalendar.thisMonth; 
    var d = WebCalendar.thisDay;
    var h = WebCalendar.thisHour;
    var mi = WebCalendar.thisMinute;
    var s = WebCalendar.thisSecond;
    WebCalendar.daysMonth[1] = (0==y%4 && (y%100!=0 || y%400==0)) ? 29 : 28;
    if (!(y<=9999 && y >= 1000 && parseInt(m, 10)>0 && parseInt(m, 10)<13 && parseInt(d, 10)>0)){
        alert("对不起，你输入了错误的日期！");
        WebCalendar.thisYear   = new Date().getFullYear();
        WebCalendar.thisMonth  = new Date().getMonth()+ 1;
        WebCalendar.thisDay    = new Date().getDate(); 
        WebCalendar.thisHour   = new Date().getHours();    
        WebCalendar.thisMinute = new Date().getMinutes();
        WebCalendar.thisSecond = new Date().getSeconds(); 
        }
        y = WebCalendar.thisYear;
        m = WebCalendar.thisMonth;
        d = WebCalendar.thisDay;
        h = WebCalendar.thisHour;
        mi = WebCalendar.thisMinute;
        s = WebCalendar.thisSecond;

    WebCalendar.iframe.meizzYearHead.innerText  = y +" 年";
    WebCalendar.iframe.meizzYearMonth.innerText = parseInt(m, 10) +" 月";
    WebCalendar.iframe.meizzHourHead.innerText =appendZero(parseInt(h, 10)) +" 时";
    WebCalendar.iframe.meizzMinuteHead.innerText =appendZero(parseInt(mi, 10)) +" 分";
    WebCalendar.iframe.meizzSecondHead.innerText =appendZero(parseInt(s, 10))+" 秒";

    WebCalendar.daysMonth[1] = (0==y%4 && (y%100!=0 || y%400==0)) ? 29 : 28; //闰年二月为29天
    var w = new Date(y, m-1, 1).getDay();
    var prevDays = m==1  ? WebCalendar.daysMonth[11] : WebCalendar.daysMonth[m-2];
    for(var i=(w-1); i>=0; i--) //这三个 for 循环为日历赋数据源（数组 WebCalendar.day）格式是 d/m/yyyy
    {
        WebCalendar.day[i] = prevDays +"/"+ (parseInt(m, 10)-1) +"/"+ y;
        if(m==1) WebCalendar.day[i] = prevDays +"/"+ 12 +"/"+ (parseInt(y, 10)-1);
        prevDays--;
    }
    for(var i=1; i<=WebCalendar.daysMonth[m-1]; i++) WebCalendar.day[i+w-1] = i +"/"+ m +"/"+ y;
    for(var i=1; i<39-w-WebCalendar.daysMonth[m-1]+1; i++)
    {
        WebCalendar.day[WebCalendar.daysMonth[m-1]+w-1+i] = i +"/"+ (parseInt(m, 10)+1) +"/"+ y;
        if(m==12) WebCalendar.day[WebCalendar.daysMonth[m-1]+w-1+i] = i +"/"+ 1 +"/"+ (parseInt(y, 10)+1);
    }
    for(var i=0; i<39; i++)    //这个循环是根据源数组写到日历里显示
    {
        var a = WebCalendar.day[i].split("/");
        WebCalendar.dayObj[i].innerText    = a[0];
        WebCalendar.dayObj[i].title        = a[2] +"-"+ appendZero(a[1]) +"-"+ appendZero(a[0]);
        WebCalendar.dayObj[i].bgColor      = WebCalendar.dayBgColor;
        WebCalendar.dayObj[i].style.color  = WebCalendar.wordColor;
        if ((i<10 && parseInt(WebCalendar.day[i], 10)>20) || (i>27 && parseInt(WebCalendar.day[i], 10)<12))
            WebCalendar.dayObj[i].style.color = WebCalendar.wordDark;
        if (WebCalendar.inputDate==WebCalendar.day[i])    //设置输入框里的日期在日历上的颜色
        {WebCalendar.dayObj[i].bgColor = WebCalendar.darkColor; WebCalendar.dayObj[i].style.color = WebCalendar.lightColor;}
        if (WebCalendar.day[i] == WebCalendar.today)      //设置今天在日历上反应出来的颜色
        {WebCalendar.dayObj[i].bgColor = WebCalendar.todayColor; WebCalendar.dayObj[i].style.color = WebCalendar.lightColor;}
    }
}
function returnDate() //根据日期格式等返回用户选定的日期
{
    if(WebCalendar.objExport)
    {
        var returnValue;
        var a = (arguments.length==0) ? WebCalendar.day[this.id.substr(8)].split("/") : arguments[0].split("/");
        var d = WebCalendar.format.match(/^(\w{4})(-|\/)(\w{1,2})\2(\w{1,2})$/);
        if(d==null){alert("你设定的日期输出格式不对！\r\n\r\n请重新定义 WebCalendar.format ！"); return false;}
        var flag = d[3].length==2 || d[4].length==2; //判断返回的日期格式是否要补零
        returnValue = flag ? a[2] +d[2]+ appendZero(a[1]) +d[2]+ appendZero(a[0]) : a[2] +d[2]+ a[1] +d[2]+ a[0];
        if(WebCalendar.timeShow)
        {
            var h = WebCalendar.thisHour, m = WebCalendar.thisMinute, s = WebCalendar.thisSecond;
            returnValue += flag ? " "+ appendZero(h) +":"+ appendZero(m) +":"+ appendZero(s) : " "+  h  +":"+ m +":"+ s;
        }
        WebCalendar.objExport.value = returnValue;
        hiddenCalendar();
    }
}

function document.onclick()
{
    if(WebCalendar.eventSrc != window.event.srcElement) hiddenCalendar();
}

</script>
<script language="javascript">

	var hwnd;
	var hwnd1;
	var tempNode;
	var FDListString11;
	var tmpStr_array;
	var sCameraID="";
	var sChannelID="";
	var b_HasLogin=false;
	var tree,rootNode;
	var sDstFilePath="C:\\myrecord\\";
	
//初始化OCx控件
function init()
{
	//alert(VOcx);
	hwnd = VOcx.Initial(12, 12, 552, 418, 0);	
	VOcx.SetWindowsNumber(1);
	lResult = WebOcx.Initial(0);	
//alert("init");
}
//创建数组
function IniArray(size)
{
  for(var i = 0; i < size; i++)
  {
    this[i] = "";
  }
  this.length=size;
  return this;
}
//登陆方法
function Login()
{
    var	lResult = 1;
		var userName = document.form1.userName.value;
		var userPassword = document.form1.userPassword.value;
		var loginIp = document.form1.loginIp.value;
		var loginPort = document.form1.loginPort.value;
		console.log(userName);
		console.log(userPassword);
		if(userName==null || userName==""){
		alert("帐号不能为空，请重新填写！");
		return false;
	   }
	  if(userPassword==null || userPassword==""){
		alert("密码不能为空，请重新填写！");
		return false;
	   }

lResult = WebOcx.Login(loginIp,loginPort,"",userName,userPassword); 



	  if(lResult != 0){
			alert("登陆失败!");
		}else{
			WebOcx.GetDeviceList();
		}


            
//setTimeout(function(){WebOcx.PlayVideo(VOcx.GetHwndbyNo(2),"121530000100000062",1);},3000);

//setTimeout(function(){WebOcx.PlayVideo(VOcx.GetHwndbyNo(3),"121520000100000057",1);},4000);

			//WebOcx.PlayVideo(VOcx.GetHwndbyNo(3),"121520000100000057",1);
}

//退出平台
function Quit()
{
  WebOcx.Logout();
  WebOcx.Free();
VOcx.Free();
  //alert("quit");
}

//开始视频
function Start()
{
	//WebOcx.PlayVideoEx(hwnd,sCameraID,sChannelID,0);	
        WebOcx.PlayVideo(hwnd,sCameraID,sChannelID);
}
//停止视频
function Stop()
{

	//WebOcx.StopVideo(hwnd);
WebOcx.GetUserMPList();

}

//查询预设位
function QueryPreset()
{
  WebOcx.QueryPreset(hwnd);
}
</script>


<script>
//解析字符串
function parseXml(cString) {
	// 然后开始获取 fdInfo.xml 需要的的第一个节点的属性值
//	alert(cString);
	if(tree == "" || typeof(tree) == 'undefined'){
	tree = new Ext.tree.TreePanel('tree-div', {
		animate : true,
		line : true,
		selMode : true,
		rootVisible : true,
		loader : false
	});

	rootNode = new Ext.tree.TreeNode( {
		text : '设备列表',
		draggable : false,
		id : '0'
	});
	
	
	tree.on("click", function(node) {
		if (node != null) {
			if (node.isLeaf()) {
				var TwoID = node.attributes.id;
				sCameraID = TwoID.substring(0,18);
				sChannelID = TwoID.substring(19,20);
			    Ext.get('fdNameSelect').dom.value = node.attributes.text;
			}
		}
	});
	
		tree.on("dblclick", function(node) {
				if (node != null) {
					if (node.isLeaf()) {
					var TwoID = node.attributes.id;
				      sCameraID = TwoID.substring(0,18);
				      sChannelID = TwoID.substring(19,20);				
                 

		  		    WebOcx.StopVideo(hwnd);
					//PanelHandle = WndContainerOcx.GetPanelHandle();// 获得空闲窗口句柄
					re = WebOcx.PlayVideo(hwnd,sCameraID,sChannelID);
	
	         } else {
						if(node.attributes.cls != "folder")
						{
							tempNode = node;
							IniFDID=node.attributes.id;
							var ChannelList = WebOcx.GetChannelList(node.attributes.id);
							node.expand(true);	
			  		}
			  			
			  		else {
			  	    node.collapseChildNodes();
			      }			
		   }
    }
	}		);
}
  var tmpStr_array =cString.split("$");
  
	for (var i = 1;i < tmpStr_array.length; i++) 
		{
	  
	 var tmpStr_array2=tmpStr_array[i].split("|");
	 var fdId = tmpStr_array2[0];
	 var fdName = tmpStr_array2[1];
	 var Status = tmpStr_array2[3];
	 var flag = false;
		
		if(Status == 0)
		{
			flag = true;
		}else{
			flag = false;
		}
		var childNode = new Ext.tree.TreeNode( {
			id : fdId,
			text : fdName,
			icon : 'images/list-items.gif',
			disabled: flag,
			leaf : false
			//cls : 'folder'
		});
		rootNode.appendChild(childNode);
			
	}

	tree.setRootNode(rootNode);
	tree.render();
	rootNode.expand();		
}	

function addChild(node,ChannelListString)
	{
			var chStr_array =ChannelListString.split("$");
			var childLength =chStr_array.length;
			  if (childLength > 0) {
	     for (var j = 1;j < childLength; j++) {
			  
	    var chStr_array2=chStr_array[j].split("|");
	    var channelId = chStr_array2[0];
	    var channelName = chStr_array2[3];
							var childNode = new Ext.tree.TreeNode( {
								id : channelId,
								text : channelName,
								disabled : false,
								icon : 'images/onlineMp.gif',
								leaf : true,
								cls : 'file'
							});
							node.appendChild(childNode);
							node.expand(true);
							node.attributes.cls="folder";						
					}
				}			
}

//云台上转
function TurnUp()
{
	WebOcx.PTZControlEx(hwnd,1,5); 
}
//云台下转
function TurnDown()
{ 
    WebOcx.PTZControlEx(hwnd,2,5);
}		
//云台的左转
function TurnLeft()
{
       
   WebOcx.PTZControlEx(hwnd,3,5);
}
//云台的右转
function TurnRight()
{   
    WebOcx.PTZControlEx(hwnd,4,5);
}

//变亮
function Brighten()
{
    WebOcx.PTZControlEx(hwnd,5,5);
}
//变暗
function Darken()
{
    WebOcx.PTZControlEx(hwnd,6,5);
}
//停止转动
function StopTurn()
{
    WebOcx.PTZControlEx(hwnd,0,5);   
}
//拉远镜头
function LenFar()
{
    WebOcx.PTZControlEx(hwnd,8,5);

}
//拉近镜头
function LenNear()
{
    WebOcx.PTZControlEx(hwnd,7,5);
}
//改变窗口数目
function changeScreen(lWndNumber)
{	 
	  VOcx.SetWindowsNumber(lWndNumber);	 
}

	function cacthPicture(){
		var sFullID = WebOcx.GetCameraIDEx(hwnd);
		var picfullpath;
		var picPath = "c:\\SURFINGEYE\\PIC\\"; //本地抓图路径
		if (sFullID == "" || sFullID == "undefined") {
	        alertMsg.error('获取监控点失败！');
		} else {
			if(sFullID.length == 20){
				picfullpath = picPath + sFullID + "_" + getCurrentTime() +".jpg";
			}else{
				var sMpID = sFullID.substring(7,25) + sFullID.substring(33,35);
				var fileName = sMpID + "_" + getCurrentTime() +".jpg";
				picfullpath = picPath + fileName;
			}
		    //alert(picfullpath);
			rs = WebOcx.CaptureImage(hwnd,picfullpath);
			if (rs == 0) {
		        alert('抓图成功！');
			} else {
		        alert('抓图失败');
			}
		}

	}
	//开始录像
	function startRec(){
		var recPath = "c:\\SURFINGEYE\\RECORD\\"; //本地抓图路径
		var sFullID = WebOcx.GetCameraIDEx(hwnd);
		var recfullpath;
		if (sFullID == "" || sFullID == "undefined") {
	        alertMsg.error('获取监控点失败！');
	        return;
		}
		if(sFullID.length == 20){
			recfullpath = recPath + sFullID + "_" + getCurrentTime();
		}else{
			var sMpID = sFullID.substring(7,25) + sFullID.substring(33,35);
			var sCameraID = sFullID.substring(7,25);
			var sChannelID = sFullID.substring(33,35);
			var fileName = sMpID + "_" + getCurrentTime();
			recfullpath = recPath + fileName;
		}
		rs = WebOcx.StartRecordEx(hwnd, recfullpath);
		if (rs != 0) {
			alert('开始录像失败！');
		}else{
			alert('开始录像！');
		}
	}
	//结束录像
	function  stopRec() {
		rs = WebOcx.StopRecordEx(hwnd);
	    if (rs == 0) {
			alert('停止录像成功！');
		} else {
			alert('停止录像失败！');
		}

	}

//获取当前时间
	function getCurrentTime(){
		var date = new Date(); 
		var yy = date.getFullYear(); 
		var MM = date.getMonth() + 1; 
		if(MM<10) MM = "0" + MM;
			var dd=date.getDate(); 
		if(dd<10) dd = "0" + dd;
			var hh=date.getHours(); 
		if(hh<10) hh = "0" + hh;
			var mm=date.getMinutes(); 
		if(mm<10) mm = "0" + mm;
			var ss=date.getSeconds(); 
		if(ss<10) ss = "0" + ss;
			var sss=date.getMilliseconds();  
		return (yy + MM + dd + hh + mm + ss + sss); 
	}
</script>
<script language="javascript" for="WebOcx" event="NotifyRecordMessage(sCameraID, sList);">
	
    getRecordList(sList);
    
</script>

<script language="javascript" for="WebOcx" event="NotifyDeviceListMessage(sDeviceList);">
	//alert("NotifyDeviceListMessage(),sDeviceList="+sDeviceList);
//	FDListString = sDeviceList;
  parseXml(sDeviceList);
	  
</script>

<script language="javascript" for="WebOcx" event="NotifyChannelMessage(sChannels);">

	var ChannelListString = sChannels;	
  addChild(tempNode,ChannelListString);
	
</script>

<script language="javascript" for="VOcx" event="OnChangeFocus(hWnd);">
	hwnd = hWnd;
</script>

<script language="javascript" for="VOcx" event="OnPTZControl(hWnd,lPTZCommand,sPuID,sChannelID);">
	WebOcx.PTZControlEx(hWnd,lPTZCommand,5);
</script>

<script language="javascript" for="WebOcx" event="OnMessage(hWnd, sCameraID, lMsgID, sMessage);">
//	alert(sMessage);
        if(0x80050007==lMsgID)
           alert("录像下载结束");
</script>

<script language="javascript" for="WebOcx" event="NotifyUserMPListMessage(sMPListInfo);">
        alert(sMPListInfo);
</script>

<!----窗口状态设置事件---->
<script language="javascript" for="WebOcx" event="ChangePlayWindowStatus(hWnd,lStatus,lType);">
	VOcx.ChangePlayWindowStatus(hWnd,lStatus);
</script>

<!----窗口关闭视频事件---->
<script language="javascript" for="VOcx" event="StopVideo(hWnd);">
	 WebOcx.StopVideo(hWnd);
	 WebOcx.StopPlayRecord(hWnd);
</script>
<!----关闭全部视频事件---->
<script language="javascript" for="VOcx" event="StopAllMonitor();">
	 WebOcx.StopAllMonitor();
</script>

<!----连接视频事件---->
<script language="javascript" for="VOcx" event="ConnectVideo(hWnd);">
	 WebOcx.PlayVideo(hWnd,"","");
</script>

<!--本地截图事件-->
<script language="javascript" for="VOcx" event="CaptureImage(hWnd);">
	hwnd = hWnd;
	cacthPicture();
</script>
<!--开始本地录像事件-->
<script language="javascript" for="VOcx" event="StartLocalRecord(hWnd);">
	hwnd = hWnd;
	startRec();
</script>
<!--停止本地录像事件-->
<script language="javascript" for="VOcx" event="StopLocalRecord(hWnd);">
	hwnd = hWnd;
	stopRec();
</script>



<script language="javascript" for="WebOcx" event="SetRecordRange(hWnd, lRange);">
  
</script>
